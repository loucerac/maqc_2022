% !TeX encoding = UTF-8
% !TeX spellcheck = en_US

\documentclass[compress,ignorenonframetext,aspectratio=1610,handout]{beamer}
\usepackage[USenglish]{babel}
\usepackage[utf8]{inputenc}
\usetheme{Cantabria}
\usepackage{url}
\usepackage{xfrac}
\usepackage{amsmath}
\usepackage{latexsym}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage[ruled]{algorithm2e}
\usepackage{graphicx}
\usepackage{alphabeta}
\usepackage{textcomp}


\usepackage[ruled]{algorithm2e}
\usepackage{subfig}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{svg}

\usepackage{calc}  
\usepackage{enumitem}  
\usepackage[compatibility=false]{caption}
\usepackage{textcomp}
\usepackage{ulem}
\usepackage{listings}
\usepackage{multimedia}
\usepackage{subfig}
\usepackage{svg}
\usepackage[export]{adjustbox}
\usepackage[super]{nth}

\setbeamerfont{footnote}{size=\tiny}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{\tiny{#1}}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

% \captionsetup{compatibility=false}


\def\xrow{
	\begin{bmatrix}
    x_1 & x_2 & \cdots & x_m
\end{bmatrix}}

\def\xsrow{
	\begin{bmatrix}
    \mathbf{X}_{:,1} & \mathbf{X}_{:,2} & \cdots & \mathbf{X}_{:,m}
\end{bmatrix}}

\def\xcol{
\begin{bmatrix}
    x_1 \\
    x_2 \\
    \vdots \\
    x_m
\end{bmatrix}}

\def\xscol{
\begin{bmatrix}
    \mathbf{X}_1 \\
    \mathbf{X}_2 \\
    \vdots \\
    \mathbf{X}_m
\end{bmatrix}}

\def\xmat{
	\begin{bmatrix}
		X_{1,1} & X_{1,2} & \cdots & X_{1,n} \\
		X_{2,1} & X_{2,2} & \cdots & X_{2,n} \\
		\vdots  & \vdots  & \ddots & \vdots  \\
		X_{m,1} & X_{m,2} & \cdots & X_{m,n} 
	\end{bmatrix}
}

\newcommand\norm[1]{\left\lVert#1\right\rVert}

 
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mypy}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize\ttfamily,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\captionsetup[figure]{labelformat=empty}% redefines the caption setup of the figures environment in the beamer class.


\usepackage[minnames=1,maxnames=1,style=authoryear,backend=bibtex]{biblatex}
\addbibresource{bibliography.bib}

\usepackage{pdfpages}

%\newcommand{\textapprox}{\hbox{$\null\approx\,\null$}}
\newcommand{\textthen}{\hbox{$\null\Rightarrow\,\null$}}


\newcommand{\sign}{\operatornamewithlimits{sign}}
\DeclareMathOperator{\mean}{mean}
\def\RR{\mathbb{R}}
\def\ZZ{\mathbb{Z}}
\def\NN{\mathbb{N}}
\DeclareMathOperator{\vect}{vec}
\DeclareMathOperator{\rtwo}{R}

\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}
\newcommand\tikzmark[1]{
  \tikz[remember picture,overlay] \coordinate (#1);
}


\newcommand{\smiley}{\tikz[baseline=-0.75ex,black]{
		\draw circle (2mm);
		\node[fill,circle,inner sep=0.5pt] (left eye) at (135:0.8mm) {};
		\node[fill,circle,inner sep=0.5pt] (right eye) at (45:0.8mm) {};
		\draw (-145:0.9mm) arc (-120:-60:1.5mm);
	}
}

\newcommand{\frownie}{\tikz[baseline=-0.75ex,black]{
		\draw circle (2mm);
		\node[fill,circle,inner sep=0.5pt] (left eye) at (135:0.8mm) {};
		\node[fill,circle,inner sep=0.5pt] (right eye) at (45:0.8mm) {};
		\draw (-145:0.9mm) arc (120:60:1.5mm);
	}
}

\newcommand{\neutranie}{\tikz[baseline=-0.75ex,black]{
		\draw circle (2mm);
		\node[fill,circle,inner sep=0.5pt] (left eye) at (135:0.8mm) {};
		\node[fill,circle,inner sep=0.5pt] (right eye) at (45:0.8mm) {};
		\draw (-135:0.9mm) -- (-45:0.9mm);
	}
}

\newcommand{\tabitem}{%
  \usebeamertemplate{itemize item}\hspace*{\labelsep}}

\usepackage{mdwlist}
\usepackage{lmodern}

\addtobeamertemplate{theorem begin}{\normalfont}{}

\usefonttheme[onlymath]{serif}

\AtBeginEnvironment{frame}{\setcounter{footnote}{0}}

% \useinnertheme{circles}
% \newenvironment{trienv}{\only{\setbeamertemplate{items}[triangle]}}{}
% \newenvironment{squareenv}{\only{\setbeamertemplate{items}[square]}}{}

%\defbeamertemplate{itemize item}{circle}{\small\raise0.5pt\hbox{\textbullet}}

% \usepackage{mathptmx}
% \usepackage[scaled=0.9]{helvet}
% \usepackage{courier}

\title[Drug repurposing for COVID-19 with Real World Evidence]{Drug repurposing for COVID-19 using explainable machine learning and mechanistic models of signal transduction circuits related to SARS-CoV-2 infection with real world data validation}
\author{Carlos Loucera}
\institute{
	Bioinformatics Area, Andalusian Public Foundation Progress and Health-FPS, 41013 Sevilla, Spain \\
	Institute of Biomedicine of Seville, IBiS, University Hospital Virgen del Roc√≠o/CSIC/University of Seville, 41013 Sevilla, Spain
}
\date{
	MAQC 2022 \\ 
	2022 September 26}

\setbeamertemplate{frametitle}[default][center]

\begin{document}

% standard title page2
%\frame[plain]{\titlepage}
%\setbeamertemplate{footline}{}

% title page with custom logos
\begin{frame}[plain]
	\vspace{\stretch{1}} % push title down a little
	\titlepage % write standard title page
	\vspace{\stretch{.5}}
	% vertically center logos with raisebox

	\hspace{\stretch{1}}
	\raisebox{-0.5\height}{\includegraphics[width=7.0cm]{figs/logos/fps_logo}}
	\hspace{\stretch{1}}
	\raisebox{-0.5\height}{\includegraphics[width=3.5cm]{figs/logos/ibi_logo.png}}
	\hspace{\stretch{1}}
	\raisebox{-0.5\height}{\includegraphics[width=1.5cm]{figs/logos/logo-vectorizado}}
	\hspace{\stretch{1}}
	% \raisebox{-0.5\height}{\includegraphics[width=1.5cm]{figs/US-marca-digital-cuadrada.eps}}
	\addtocounter{framenumber}{-1} 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

\begin{frame}{
	Infrastructure for secure generation of Real World Evidence from Real World Data from the Andalusian Health Population Database}
	\begin{columns}
		\column{0.99\textwidth}
		\begin{figure}
			\includegraphics[width=0.85\textwidth]{figs/intro/irwd_esquema.png}
		\end{figure}

	\end{columns}
\end{frame}



\begin{frame}{Knowledge paradigm}
	\begin{columns}
		\column{0.99\textwidth}
		\begin{figure}
			\includegraphics[width=0.85\textwidth]{figs/methods/knowdge_paradigm-crop.pdf}
		\end{figure}

	\end{columns}
\end{frame}



\begin{frame}{Knowledge discovery}

	\textbf{Living Contradiction} is a fascinating, honest examination of that genuine contradiction faced 
	by teachers in reconciling the effort made to \emph{encourage} young people towards \emph{independent 
	critical thinking}, with the simultaneous sense of \emph{responsibility to instruct} and insist 
	on a particular behavior. \\

	\vspace*{1em}

	\textbf{Trustworthiness} \\

	\vspace*{1em}

	The \textbf{WHY} is as important as the \textbf{WHAT} \\

	\blfootnote{\url{https://www.crownhouse.co.uk/product-review/10842}}

\end{frame}

\section{Methods}


\begin{frame}{Building a COVID-19 Disease Map}
	\begin{columns}
		\begin{column}{0.6\textwidth}
			\centering
			\includegraphics[width=0.9\textwidth]{figs/methods/covid19-diseasemap-consrtium.jpg}
			\captionof{figure}{COVID-19 Disease Map\footnotemark }

		\end{column}

		\pause

		\begin{column}{0.4\textwidth}

		\end{column}

	\end{columns}
	\footnotetext[1]{\fullcite{ostaszewski2021covid19}}

\end{frame}

\begin{frame}{Building a COVID-19 Disease Map}

	\begin{columns}
		\begin{column}{0.6\textwidth}
			\centering
			\includegraphics[width=0.9\textwidth]{figs/methods/covid19_diseasemap.jpg}
			\captionof{figure}{COVID-19 Disease Map\footnotemark }

		\end{column}

		\pause

		\begin{column}{0.4\textwidth}
			\centering
			\includegraphics[width=0.8\textwidth]{figs/methods/covipathia.png}
			\captionof{figure}{(Simplified) COVID-19 Disease Map\footnotemark }

		\end{column}

	\end{columns}
	\footnotetext[1]{\fullcite{ostaszewski2021covid19}}
	\footnotetext[2]{\fullcite{rian2021mechanistic}}
\end{frame}


\begin{frame}{Mechanistic modeling}

	\begin{columns}
		\begin{column}{0.6\textwidth}
			\begin{figure}
				\centering
				\includegraphics[width=0.99\textwidth]{figs/methods/circuit.png}
			\end{figure}
		\end{column}
		\begin{column}{0.4\textwidth}
			\begin{figure}
				\centering
				\includegraphics[width=0.99\textwidth]{figs/methods/hipathia_paper.png}
			\end{figure}
		\end{column}
	\end{columns}

	\pause

	\vspace*{2em}
	{\normalsize
		\[
			S_{n} = v_{n} \left( 1 - \prod_{s_{a} \in \mathcal{A}} \left( 1 - s_{a} \right) \right) \prod_{s_{i} \in \mathcal{I}} \left( 1 - s_{i} \right)
		\]
	}
\end{frame}



\begin{frame}{Drug repurposing schema}
	\begin{columns}
		\column{0.99\textwidth}
		\begin{figure}
			\includegraphics[width=0.99\textwidth]{figs/methods/COVI-19_drugRepo.png}
		\end{figure}

	\end{columns}
\end{frame}

\begin{frame}{ML pipeline}
		Our \textbf{FS} model makes decissions based on the \textbf{SHAP} ranks\\

		We want to be \textbf{true to the data}
		\begin{itemize}
			\item Avoid overconfidence
			\item Draw from a background distribution
			\item Compute the explanations using a different subset
		\end{itemize}
		(Remember) We need an unbiased circuit-based $\rtwo^2$ scoring system

		\begin{figure}
		\centering\includegraphics[width=0.8\textwidth]{figs/methods/val.pdf}
		\end{figure}

		(Nogueira) Build a population (repeat the whole procedure \textbf{100 times})

		Make it faster: \textbf{GPU-CUDA}
\end{frame}


\begin{frame}{Data-driven Validation (Performance + Explanations)}
	\begin{columns}
		\column{0.25\textwidth}
		
		\column{0.5\textwidth}
		
			\begin{block}{Explanation stability}
				Robustness Vs Stochastic, Noise, Sampling
				
				100 Holdout splits of half the sample size
				
				Split \textit{training} into \textit{learning} and \textit{validation}
				
				Check unbiased performance over \textit{test}
				
				Compute Nogueiras\footnotemark statistic test and CI
				
			\end{block}

		\column{0.25\textwidth}
		
	\end{columns}

	\pause
	
	\vspace{1em}%
	
	\begin{columns}
		\column{0.67\textwidth}
		\begin{figure}
			\centering
			\includegraphics[width=0.9\textwidth]{figs/methods/cv_performance_distribution.pdf}
			\caption{$R^2$ score distribution over the test splits}
		\end{figure}
	
		\column{0.33\textwidth}
		\texttt{Mean} $R^2$: $0.82 \pm 0.02$
		
		\texttt{N-Stat CI}: $(0.729, 0.735)$
		
	\end{columns}
	
	\footnotetext[1]{\fullcite{nogueira2017stability}}

\end{frame}


\begin{frame}
	
	\begin{columns}
		
		\column{0.5\textwidth}
		
		\begin{block}{SHapley Additive exPlanations}
				Fair feature responsibility attribution.
				
				Dis-aggregated by circuit by construction.
				
				Additive (use biologically-relevant groups).
		\end{block}
	
		\column{0.5\textwidth}
		\begin{block}{Template patterns}
			Conform a series of templates, e.g.:
			
			\begin{itemize}
				\item Affect massively almost all \textsc{Map}
				\item Affect a few very specific circuits
			\end{itemize}
			
		\end{block}
	\end{columns}
	
	\pause
	
	\centering
	\includegraphics[width=0.95\textwidth]{figs/methods/patterns.pdf}
\end{frame}



\begin{frame}
	\begin{columns}
		\column{0.5\textwidth}
		\centering
		\includegraphics[width=0.9\textwidth]{figs/methods/radar.png}
		
		\column{0.5\textwidth}
		\begin{itemize}
		\item 380 KDTs (targeted by 679 drugs) have direct influence over the whole or partial parts of the map.
		\item The GO biological processes enriched are mostly related to immune activity (T-cell, inflammatory response)
		\item The COVID-19 Hallmarks are represented.
	\end{itemize}
	\end{columns}
\end{frame}



\section{Results}

\begin{frame}{Data facts}

	\begin{columns}
		\begin{column}{0.55\textwidth}
			Andalusian public health system

			Year 2020, no COVID-vaccine \\

			15968 COVID-19 hospitalized patients \\

			End point: COVID-19 certified death (28 days) 

			\begin{figure}
				\includegraphics[width=0.94\textwidth]{figs/results/hospitalizations_timeline.pdf}
			\end{figure}

		\end{column}

		\begin{column}{0.45\textwidth}
		\begin{figure}
			\includegraphics[width=0.99\textwidth]{figs/results/covariates.png}
		\end{figure}

		\end{column}


	\end{columns}

	
\end{frame}


\begin{frame}{Methods Facts}

	We Only include properly balanced treatments\footnotemark \\

	\begin{itemize}
		\item 964 treatments found
		\item 122 were eligible
	\end{itemize}
	
	HR Closed-form variance estimator for Weighted Propensity Scores\footnotemark \\

	Lymphocyte count registered up to 14 days since hospitalization begins \\

	Covariate-adjusted linear mixed effect model to test Lymphocyte progression trends

	\begin{itemize}
		\item 30 treatments are significant for both tests
		\item 22 after FDR adjustment
	\end{itemize}

	\footnotetext[1]{\fullcite{stuart2013prognostic}}
	\footnotetext[2]{\fullcite{hajage2018closed}}
	
\end{frame}

\begin{frame}{Covariate-Adjusted LHR by Treatment}
	\begin{columns}
		\column{0.8\textwidth}
		\begin{figure}
			\includegraphics[width=0.94\textwidth]{figs/results/bps_covid_repurposing_summary.pdf}
		\end{figure}

		\column{0.2\textwidth}
		\begin{figure}
			\includegraphics[width=0.7\textwidth]{figs/logos/bps.png}	
		\end{figure}

		\begin{figure}
			\includegraphics[width=0.7\textwidth]{figs/logos/logo-vectorizado-crop.pdf}	
		\end{figure}

	\end{columns}
\end{frame}


\begin{frame}{Covariate-Adjusted Lymphocyte trend}
	\begin{columns}
		\column{0.5\textwidth}
		\begin{figure}
			\includegraphics[width=0.8\textwidth]{figs/results/db00695_furosemide_lymphocite_progression.pdf}	
		\end{figure}

		\column{0.5\textwidth}
		\begin{figure}
			\includegraphics[width=0.8\textwidth]{figs/results/db00146_calcifediol_lymphocite_progression.pdf}	
		\end{figure}

	\end{columns}

	\begin{figure}
		\includegraphics[width=0.4\textwidth]{figs/results/db09258_bemiparin_lymphocite_progression.pdf}	
	\end{figure}


\end{frame}


\begin{frame}{Conclusions}

	\textbf{Bemiparinand} and \textbf{Enoxaparin} \textrightarrow Highest survival
	\begin{itemize}
		\item prevent thrombotic and thromboembolic complications
		\item enoxaparin has been previously reported as protective
		\item the protective effect is not shared by other anticoagulants
	\end{itemize}

	\textbf{Calcifediol} and \textbf{Cholecalciferol} have a protective effect
	\begin{itemize}
		\item probably due to vitamin D and its pro-immune and anti-inflammatory properties.
	\end{itemize}

	There is a \textbf{significative intersection} between \textbf{ML predicted drugs} and \textbf{RWE}
	\begin{itemize}
		\item $\chi^{2} = 6.674, \; \mathtt{pvalue} = 0.009785$
	\end{itemize}

\end{frame}

\begin{frame}{Simvastatin summary}

	\begin{figure}
		\includegraphics[width=0.8\textwidth]{figs/results/simvastatin_summary_.png}	
	\end{figure}
		
	\begin{columns}
		\column{0.5\textwidth}
			
		\begin{figure}
			\includegraphics[width=0.9\textwidth]{figs/results/db00641_simvastatin_lymphocite_progression.pdf}	
		\end{figure}
		\column{0.5\textwidth}

	\end{columns}

\end{frame}

\begin{frame}{Closing remarks}
	
	It is not a competition between paradigms and methods \\

	We aim to gain evidences from as many sources as possible \\

	Our xML tools aim to help users prioritize their work:
	\begin{itemize}
		\item  \textit{look for a needle in a haystack}
	\end{itemize}

\end{frame}



\section{Thanks}

	\begin{frame}{}
		\begin{center}
			{\fontsize{40}{50}\selectfont Thank You!}
		\end{center}
	\end{frame}


	\begin{frame}{Personal funding. Contact: \url{carlos.loucera@juntadeandalucia.es}}

		\raisebox{-0.45\height}{\includegraphics[width=5cm]{figs/logos/logo_postdoc_consejeria.jpeg.jpg}}
		\hspace{\stretch{1}}
		\raisebox{-0.45\height}{\includegraphics[width=3cm]{figs/logos/logo_postdoc_eu.png}}
		\hspace{\stretch{1}}

		\vspace{0.3cm}

		Carlos Loucera postdoctoral contract \texttt{PAIDI2020-DOC\_00350} is funded by Junta de Andaluc√≠a and co-funded by the European Social Fund (FSE) 2014-2020

		\vspace{0.3cm}

		\begin{center}
			\raisebox{-0.5\height}{\includegraphics[width=3cm]{figs/logos/logo_postdoc_jdaeu.png}}
		\end{center}
	\end{frame}

	\begin{frame}
		\vspace*{-1pt}
		\makebox[\linewidth]{\includegraphics[page=1,width=0.65\paperwidth]{figs/people/fps_final_slide.pdf}}
	\end{frame}

\end{document}
